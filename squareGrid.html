<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>Phaser - Square Grid</title>

  <script src="phaser.min.js"></script>

</head>
<body>

<!-- Include self-created classes -->
<script src = "shapes/SolidSquare.js"></script>
<script src = "shape-composites/squareGrid.js"></script>
<script src = "animation-phases/square-slide-animation.js"></script>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'animation-canvas', { create: create, update: update });

var centerX = game.width / 2;
var centerY = game.height / 2;
var graphics;

// For timing the animations
var delayCounter = 0;
var delayNeeded = true;
var animationNumber = 0;

var twoSquares = [];

// ------- For square reveal ----------
var revealSquareGrid;
var squaresInColumn = 6;
var squareSize;
var numberOfSquares;
var squaresOnRow;

var checkeredGrid;
var squareRevealMove = 5;
var squareRevealGoal = 0;

// ------- For spinning squares ----------
// Reuse the checkeredGrid
var rotationSum = 0;
var rotationAngle = 1;

/*
 *                C R E A T E
 * ============================================
 */
function create() {

  graphics = game.add.graphics(0,0);

  // Prepare background etc. for the squareslide animation
  prepareSquareSlideAnimation(game.width, game.height);

  // For square reveal

  // Create the squares that will be moved to reveal the 6 x 8 checkered square grid
  revealSquareGrid = createRevealSquares(game.width, game.height, squaresInColumn);

  // Create the checkered 6 x 8 square grid
  checkeredGrid = createCheckeredHalfEmptyGrid(game.width, game.height, squaresInColumn, "0xffffff", true);

}

/*
 *                U P D A T E
 * ============================================
 */
function update(){

  graphics.clear();

  // "Lift" the background to go from blank background to two recntangles
  if(animationNumber == 0){

    //When lifting the background has finished, move to the next animation
    if(liftBackground(centerY, 20)){
      animationNumber = 1;
    }
  }

  // Create two
  if(animationNumber == 1){
    drawPolygonShape(background, bgColor);
    createTwoSquares(game.width/2);
    animationNumber = 2;
    // TODO Apply delay?
  }

  //
  if(animationNumber == 2){
    drawPolygonShape(background, bgColor);

    if(twoSquaresSlidingFromTheRight(centerX, 10)){
        animationNumber = 3;
        delayCounter = 0;
    }
  }

  // Go from two recntangles to four recntangles
  if(animationNumber == 3){
    drawPolygonShape(background, bgColor);
    drawPolygonShape(twoSquares[0], "0x000000");
    drawPolygonShape(twoSquares[1], "0xffffff");

    delayCounter++;

    if(delayCounter >= 20){
      animationNumber = 4;
      delayCounter = 0;
    }
  }


  if(animationNumber == 4){
    if(squareRevealGoal <= squareSize){
      moveRevealSquares(game.width, game.height, squareSize, squareRevealMove, revealSquareGrid)
      squareRevealGoal += squareRevealMove;
    }
    else {
      delayCounter++;

      if(delayCounter >= 20){
        animationNumber = 6; //TODO Fix
        delayCounter = 0;
      }
    }

    drawSquareGrid(graphics, checkeredGrid);
    drawSquareGrid(graphics, revealSquareGrid);
  }

  // TODO Pulse squares
  if(animationNumber == 5){



  }


  // Spin squares
  if(animationNumber == 6){

    spinSquaresTwoDirections(graphics, checkeredGrid, rotationAngle);

    if(rotationSum < 179){
      rotationSum += Math.abs(rotationAngle);
    }
    else {
      checkeredGrid = createCheckeredHalfEmptyGrid(game.width, game.height, squaresInColumn, "0x000000", false);
      game.stage.backgroundColor = 0xffffff;
      animationNumber = 7;
    }


  }


  if(animationNumber == 7){
    drawSquareGrid(graphics, checkeredGrid);
    spinSquaresTwoDirections(graphics, checkeredGrid, rotationAngle);
  }



}

// ------- DELAY -------
function delay(delayAmount){

}


</script>

</body>
</html>
