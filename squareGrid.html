<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>Phaser - Square Grid</title>

  <script src="phaser.min.js"></script>

  <style type="text/css">

    body {
      margin: 20px;
    }

  </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'phaser-example', { create: create, update: update });

var centerX = game.width / 2;
var centerY = game.height / 2;
var graphics;

var backgroundpoints = [new Phaser.Point(0, 0),
                        new Phaser.Point(game.width, 0),
                        new Phaser.Point(game.width, game.height),
                        new Phaser.Point(0, game.height)];

var background;
var bgColor = "0xffffff";

// For timing the animations
var delayCounter = 0;
var delayNeeded = true;
var animationNumber = 0;

var twoSquares = [];


function create() {

  graphics = game.add.graphics(0,0);

  background = new Phaser.Polygon(backgroundpoints);

}

function update(){

  graphics.clear();


  if(animationNumber == 0){

    //When lifting the background has finished, move to the next animation
    if(liftBackground(centerY, 20)){
      animationNumber = 1;
    }
  }

  //
  if(animationNumber == 1){
    drawPolygonShape(background, bgColor);
    createTwoSquares(game.width/2);
    animationNumber = 2;
    // TODO Apply delay?
  }

  //
  if(animationNumber == 2){
    drawPolygonShape(background, bgColor);

    if(twoSquaresSlidingFromTheRight(centerX, 10)){
        animationNumber = 3;
    }
  }

  if(animationNumber == 3){
    drawPolygonShape(background, bgColor);
    drawPolygonShape(twoSquares[0], "0x000000");
    drawPolygonShape(twoSquares[1], "0xffffff");
  }

}

/*
 *
 */
function liftBackground(goal, speed){

  if(background.points[3].y > goal){
    background.points[2].y -= speed;
    background.points[3].y -= speed;
  }
  else {
    return true;
  }

  drawPolygonShape(background, bgColor);
}

/*
 *
 */
function drawPolygonShape(shape, color){

  graphics.beginFill(color);
  graphics.drawPolygon(shape);
  graphics.endFill();

  return true;
}

/*
 *
 */
function twoSquaresSlidingFromTheRight(goal, speed){

  if(twoSquares[0].points[0].x > goal){
    twoSquares[0].points = moveShapeHorizontally(twoSquares[0], -speed);
    twoSquares[1].points = moveShapeHorizontally(twoSquares[1], -speed);
  }
  else {
    //Animation finished
    return true;
  }

  drawPolygonShape(twoSquares[0], "0x000000");
  drawPolygonShape(twoSquares[1], "0xffffff");

}

/*
 * TODO Documentation
 */
function moveShapeHorizontally(shape, xChange){

  for(var i = 0; i < shape.points.length; i++){
    shape.points[i].x += xChange
  }

  return shape.points;
}

/*
 * TODO Documentation
 */
function moveShapeVertically(shape, yChange){
  for(var i = 0; i < shape.points.length; i++){
    shape.points[i].y += yChange
  }

  return shape.points;
}


/*
 * Create two squares that will slide from the side
 */
function createTwoSquares(width){

  // Upper square
  twoSquares[0] = new Phaser.Polygon([
    new Phaser.Point(game.width, 0),
    new Phaser.Point(game.width + width, 0),
    new Phaser.Point(game.width + width, game.height / 2),
    new Phaser.Point(game.width, game.height / 2)
  ]);

  // Lower square
  twoSquares[1] = new Phaser.Polygon([
    new Phaser.Point(game.width, game.height / 2),
    new Phaser.Point(game.width + width, game.height / 2),
    new Phaser.Point(game.width + width, game.height),
    new Phaser.Point(game.width, game.height)
  ]);

  // twoSquares[0] = new Phaser.Polygon([
  //   new Phaser.Point(game.width / 2, 0),
  //   new Phaser.Point(game.width / 2 + width, 0),
  //   new Phaser.Point(game.width / 2 + width, game.height / 2),
  //   new Phaser.Point(game.width / 2, game.height / 2)
  // ]);
  //
  // // Lower square
  // twoSquares[1] = new Phaser.Polygon([
  //   new Phaser.Point(game.width / 2, game.height / 2),
  //   new Phaser.Point(game.width / 2 + width, game.height / 2),
  //   new Phaser.Point(game.width / 2 + width, game.height),
  //   new Phaser.Point(game.width / 2, game.height)
  // ]);

}


</script>

</body>
</html>
